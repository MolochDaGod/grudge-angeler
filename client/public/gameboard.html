<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grudge Angeler - Game Encyclopedia</title>
  <meta name="description" content="Complete game encyclopedia for Grudge Angeler showing all fish species, equipment, characters, world zones, weather, celestial events, NPCs, and every game system.">
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <meta name="theme-color" content="#0a2540" />
  <meta property="og:title" content="Grudge Angeler - Game Encyclopedia" />
  <meta property="og:description" content="Complete game encyclopedia for Grudge Angeler." />
  <meta property="og:image" content="/icon-512.png" />
  <meta property="og:type" content="website" />
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --bg-deep: #030a18;
      --bg-surface: #0a1628;
      --bg-card: #0d1f38;
      --bg-card-hover: #122a4a;
      --border: rgba(79,195,247,0.1);
      --border-accent: rgba(79,195,247,0.3);
      --text-primary: #e0e8f0;
      --text-secondary: #8a9bb0;
      --text-dim: #506070;
      --common: #8ea8b8;
      --uncommon: #3dc9a0;
      --rare: #6e7fd8;
      --epic: #b04ec8;
      --legendary: #f0a020;
      --ultra-rare: #ff4060;
      --accent: #4fc3f7;
      --gold: #ffd54f;
      --sidebar-w: 240px;
      --header-h: 56px;
    }

    html {
      background: var(--bg-deep);
      color: var(--text-primary);
      scroll-behavior: smooth;
    }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-deep);
      min-height: 100vh;
    }

    #ocean-bg {
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
      overflow: hidden;
    }
    #ocean-bg-overlay {
      position: absolute;
      inset: 0;
      background:
        radial-gradient(ellipse at 30% 20%, rgba(10,60,120,0.4) 0%, transparent 60%),
        radial-gradient(ellipse at 70% 80%, rgba(5,30,80,0.3) 0%, transparent 50%),
        linear-gradient(180deg, rgba(4,12,30,0.9) 0%, rgba(6,24,48,0.85) 50%, rgba(10,37,64,0.9) 100%);
    }
    @keyframes bubble-rise {
      0% { transform: translateY(0) translateX(0); opacity: 0.3; }
      50% { opacity: 0.5; }
      100% { transform: translateY(-100vh) translateX(15px); opacity: 0; }
    }
    .bubble {
      position: fixed;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, rgba(120,200,255,0.3), rgba(60,150,220,0.08));
      border: 1px solid rgba(120,200,255,0.15);
      z-index: 0;
      pointer-events: none;
      animation: bubble-rise linear infinite;
    }

    /* HEADER */
    #top-header {
      position: fixed;
      top: 0; left: 0; right: 0;
      height: var(--header-h);
      background: rgba(6,14,30,0.92);
      backdrop-filter: blur(16px);
      border-bottom: 1px solid var(--border);
      z-index: 200;
      display: flex;
      align-items: center;
      padding: 0 20px;
      gap: 16px;
    }
    #top-header .logo-text {
      font-family: 'Press Start 2P', monospace;
      font-size: 11px;
      background: linear-gradient(135deg, var(--accent), var(--gold));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      white-space: nowrap;
    }
    .header-nav {
      display: flex;
      gap: 6px;
      margin-left: auto;
    }
    .header-nav a {
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
      color: var(--text-secondary);
      text-decoration: none;
      transition: all 0.2s;
      white-space: nowrap;
    }
    .header-nav a:hover { color: var(--accent); background: rgba(79,195,247,0.08); }

    /* SEARCH */
    #search-bar {
      position: fixed;
      top: var(--header-h);
      left: var(--sidebar-w);
      right: 0;
      height: 48px;
      background: rgba(8,18,34,0.92);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      z-index: 190;
      display: flex;
      align-items: center;
      padding: 0 24px;
      gap: 10px;
    }
    #search-bar svg { opacity: 0.4; flex-shrink: 0; }
    #search-input {
      flex: 1;
      background: none;
      border: none;
      outline: none;
      color: var(--text-primary);
      font-size: 14px;
      font-family: inherit;
    }
    #search-input::placeholder { color: var(--text-dim); }
    #search-count {
      font-size: 11px;
      color: var(--text-dim);
      white-space: nowrap;
    }

    /* SIDEBAR */
    #sidebar {
      position: fixed;
      top: var(--header-h);
      left: 0;
      bottom: 0;
      width: var(--sidebar-w);
      background: rgba(6,14,30,0.95);
      backdrop-filter: blur(12px);
      border-right: 1px solid var(--border);
      z-index: 180;
      overflow-y: auto;
      padding: 12px 0;
      scrollbar-width: thin;
      scrollbar-color: rgba(79,195,247,0.15) transparent;
    }
    .sidebar-label {
      padding: 10px 16px 6px;
      font-size: 9px;
      font-weight: 700;
      letter-spacing: 1.5px;
      color: var(--text-dim);
      font-family: 'Press Start 2P', monospace;
    }
    .sidebar-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 16px;
      font-size: 12px;
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.15s;
      text-decoration: none;
      border-left: 3px solid transparent;
    }
    .sidebar-item:hover { color: var(--text-primary); background: rgba(79,195,247,0.05); }
    .sidebar-item.active { color: var(--accent); border-left-color: var(--accent); background: rgba(79,195,247,0.06); }
    .sidebar-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }
    .sidebar-count {
      margin-left: auto;
      font-size: 10px;
      color: var(--text-dim);
      font-weight: 400;
    }

    /* MAIN CONTENT */
    #main-content {
      margin-left: var(--sidebar-w);
      margin-top: calc(var(--header-h) + 48px);
      padding: 28px 32px 80px;
      position: relative;
      z-index: 1;
      max-width: 1200px;
    }

    /* HERO */
    .hero-area {
      text-align: center;
      padding: 32px 0 40px;
    }
    .hero-area img {
      max-width: 200px;
      image-rendering: pixelated;
      filter: drop-shadow(0 0 20px rgba(79,195,247,0.2));
      margin-bottom: 12px;
    }
    .hero-title {
      font-family: 'Press Start 2P', monospace;
      font-size: 18px;
      letter-spacing: 3px;
      background: linear-gradient(135deg, var(--accent), var(--gold));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
    }
    .hero-sub {
      font-size: 13px;
      color: var(--text-secondary);
      letter-spacing: 1px;
    }
    .legend-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 20px;
      justify-content: center;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: var(--text-secondary);
      background: rgba(255,255,255,0.03);
      padding: 5px 10px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.04);
    }
    .legend-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    /* SECTIONS */
    .section {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 10px;
      margin-bottom: 20px;
      overflow: hidden;
      scroll-margin-top: calc(var(--header-h) + 56px);
    }
    .section-header {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 16px 20px;
      cursor: pointer;
      user-select: none;
      transition: background 0.15s;
      border-bottom: 1px solid rgba(255,255,255,0.03);
    }
    .section-header:hover { background: rgba(255,255,255,0.02); }
    .section-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      flex-shrink: 0;
    }
    .section-title {
      font-family: 'Press Start 2P', monospace;
      font-size: 10px;
      letter-spacing: 1.5px;
    }
    .section-count {
      margin-left: auto;
      font-size: 10px;
      color: var(--text-dim);
      background: rgba(255,255,255,0.04);
      padding: 3px 8px;
      border-radius: 8px;
    }
    .section-toggle {
      width: 20px;
      height: 20px;
      transition: transform 0.25s;
      color: var(--text-dim);
      flex-shrink: 0;
    }
    .section.collapsed .section-toggle { transform: rotate(-90deg); }
    .section-body {
      padding: 16px 20px 20px;
      transition: max-height 0.3s ease, opacity 0.2s;
      overflow: hidden;
    }
    .section.collapsed .section-body { display: none; }
    .section-desc {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.6;
      margin-bottom: 16px;
    }

    /* FISH GRID */
    .fish-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 10px;
    }
    .fish-card {
      background: rgba(0,0,0,0.25);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px;
      display: flex;
      gap: 12px;
      align-items: flex-start;
      transition: border-color 0.2s, background 0.2s;
    }
    .fish-card:hover {
      border-color: var(--border-accent);
      background: rgba(79,195,247,0.03);
    }
    .fish-card.search-hidden { display: none; }
    .fish-img-wrap {
      width: 56px;
      height: 56px;
      background: rgba(255,255,255,0.03);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.05);
    }
    .fish-img-wrap img {
      max-width: 48px;
      max-height: 48px;
      image-rendering: pixelated;
    }
    .fish-placeholder svg {
      width: 28px;
      height: 28px;
      opacity: 0.25;
    }
    .fish-info { flex: 1; min-width: 0; }
    .fish-name { font-size: 12px; font-weight: 600; margin-bottom: 2px; }
    .fish-desc { font-size: 11px; color: var(--text-secondary); line-height: 1.5; margin-bottom: 6px; }
    .fish-stats { display: flex; flex-wrap: wrap; gap: 4px; }
    .fish-stat {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 4px;
      background: rgba(255,255,255,0.04);
      color: var(--text-dim);
      white-space: nowrap;
    }
    .fish-stat b { color: var(--text-secondary); }
    .rarity-badge {
      font-size: 9px;
      padding: 2px 6px;
      border-radius: 4px;
      color: #fff;
      display: inline-block;
      margin-bottom: 4px;
      letter-spacing: 0.5px;
      font-weight: 600;
    }
    .stars { letter-spacing: 1px; font-size: 10px; }

    /* EQUIP GRID */
    .equip-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 10px;
    }
    .equip-card {
      background: rgba(0,0,0,0.25);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px;
      display: flex;
      gap: 10px;
      align-items: center;
      transition: border-color 0.2s;
    }
    .equip-card:hover { border-color: var(--border-accent); }
    .equip-card.search-hidden { display: none; }
    .equip-icon {
      width: 40px;
      height: 40px;
      background: rgba(255,255,255,0.04);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    .equip-icon img {
      max-width: 32px;
      max-height: 32px;
      image-rendering: pixelated;
    }
    .equip-name { font-size: 12px; font-weight: 600; margin-bottom: 3px; }
    .equip-desc { font-size: 11px; color: var(--text-secondary); line-height: 1.5; }
    .equip-price { font-size: 11px; color: #2ecc71; margin-top: 2px; font-weight: 600; }
    .equip-stats { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 4px; }

    /* ZONE / CHAR / WEATHER / CELESTIAL / ATTR / NPC CARDS */
    .world-map {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 10px;
    }
    .zone-card {
      background: rgba(0,0,0,0.25);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 14px;
      transition: border-color 0.2s;
      position: relative;
      overflow: hidden;
    }
    .zone-card:hover { border-color: var(--border-accent); }
    .zone-card.search-hidden { display: none; }
    .zone-name { font-size: 12px; font-weight: 600; margin-bottom: 4px; margin-top: 4px; }
    .zone-desc { font-size: 11px; color: var(--text-secondary); line-height: 1.5; }
    .zone-fish { font-size: 10px; color: var(--text-dim); margin-top: 6px; }
    .zone-depth { font-size: 10px; color: var(--accent); margin-bottom: 4px; opacity: 0.7; }

    .char-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 10px;
    }
    .char-card {
      background: rgba(0,0,0,0.25);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
      text-align: center;
      transition: border-color 0.2s;
    }
    .char-card:hover { border-color: var(--border-accent); }
    .char-card img { height: 96px; image-rendering: pixelated; margin-bottom: 10px; filter: drop-shadow(0 3px 8px rgba(0,0,0,0.4)); }
    .char-name { font-size: 12px; font-weight: 600; margin-bottom: 4px; }
    .char-desc { font-size: 11px; color: var(--text-secondary); line-height: 1.5; }

    .npc-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 10px;
    }
    .npc-card {
      background: rgba(0,0,0,0.25);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px;
      display: flex;
      gap: 12px;
      align-items: flex-start;
      transition: border-color 0.2s;
    }
    .npc-card:hover { border-color: var(--border-accent); }
    .npc-img-wrap {
      width: 44px;
      height: 44px;
      border-radius: 6px;
      background: rgba(255,255,255,0.04);
      flex-shrink: 0;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .npc-img-wrap canvas {
      image-rendering: pixelated;
      width: 40px;
      height: 40px;
    }

    .weather-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 10px;
    }
    .weather-card {
      background: rgba(0,0,0,0.25);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 14px;
      transition: border-color 0.2s;
      position: relative;
      overflow: hidden;
    }
    .weather-card:hover { border-color: var(--border-accent); }
    .weather-name { font-size: 12px; font-weight: 600; margin-bottom: 4px; margin-top: 4px; }
    .weather-desc { font-size: 11px; color: var(--text-secondary); line-height: 1.5; }
    .weather-effect { font-size: 10px; color: var(--accent); margin-top: 6px; opacity: 0.8; }

    .celestial-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 10px;
    }
    .celestial-card {
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
      position: relative;
      overflow: hidden;
      transition: box-shadow 0.2s;
    }
    .celestial-card:hover { box-shadow: 0 0 20px rgba(255,255,255,0.04); }
    .celestial-name { font-size: 13px; font-weight: 600; margin-bottom: 6px; }
    .celestial-desc { font-size: 11px; color: var(--text-secondary); line-height: 1.5; }
    .celestial-boost { font-size: 11px; margin-top: 8px; padding: 4px 8px; border-radius: 4px; display: inline-block; }

    .attr-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 10px;
    }
    .attr-card {
      background: rgba(0,0,0,0.25);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 14px;
      position: relative;
      overflow: hidden;
      transition: border-color 0.2s;
    }
    .attr-card:hover { border-color: var(--border-accent); }
    .attr-name { font-size: 12px; font-weight: 600; margin-bottom: 3px; margin-top: 4px; }
    .attr-desc { font-size: 11px; color: var(--text-secondary); line-height: 1.5; }
    .attr-effect { font-size: 10px; color: var(--accent); margin-top: 6px; opacity: 0.8; }

    /* SPECIAL SECTION VARIANTS */
    .ultra-variant { border-color: rgba(255,64,96,0.2); background: linear-gradient(135deg, var(--bg-card), rgba(30,10,40,0.6)); }
    .ultra-variant .fish-card { border-color: rgba(255,64,96,0.12); }
    .ultra-variant .fish-card:hover { border-color: rgba(255,64,96,0.35); }
    .predator-variant { border-color: rgba(239,83,80,0.15); background: linear-gradient(135deg, var(--bg-card), rgba(40,10,15,0.4)); }
    .celestial-variant { border-color: rgba(200,150,255,0.15); background: linear-gradient(135deg, var(--bg-card), rgba(30,10,50,0.4)); }
    .egg-variant { border-color: rgba(168,85,247,0.15); background: linear-gradient(135deg, var(--bg-card), rgba(40,15,60,0.4)); }

    /* DEEP TRENCH */
    .deep-ocean-trench {
      margin: 20px 0;
      background: linear-gradient(180deg, rgba(0,5,20,0.9), rgba(0,2,10,1));
      border: 1px solid rgba(20,40,80,0.2);
      border-radius: 10px;
      padding: 40px 24px 60px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    .trench-title {
      font-family: 'Press Start 2P', monospace;
      font-size: 10px;
      letter-spacing: 4px;
      color: rgba(40,80,140,0.4);
      margin-bottom: 16px;
    }
    .trench-desc {
      font-size: 12px;
      color: rgba(50,80,120,0.4);
      line-height: 1.7;
      max-width: 500px;
      margin: 0 auto 24px;
    }
    .hidden-treasure {
      opacity: 0.2;
      transition: opacity 1s;
    }
    .hidden-treasure:hover { opacity: 0.6; }
    .hidden-treasure img {
      width: 56px;
      height: 56px;
      image-rendering: pixelated;
      filter: drop-shadow(0 0 16px rgba(200,160,40,0.3));
    }
    .treasure-label {
      font-family: 'Press Start 2P', monospace;
      font-size: 6px;
      color: rgba(200,160,40,0.25);
      margin-top: 6px;
      letter-spacing: 2px;
    }

    /* BACK TO TOP */
    #back-to-top {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 200;
      width: 40px;
      height: 40px;
      border-radius: 8px;
      background: rgba(8,20,40,0.9);
      border: 1px solid var(--border-accent);
      color: var(--accent);
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(8px);
      transition: background 0.2s;
    }
    #back-to-top:hover { background: rgba(15,40,70,0.95); }

    /* FOOTER */
    .footer {
      text-align: center;
      padding: 30px 0;
      font-size: 11px;
      color: var(--text-dim);
    }

    /* MOBILE */
    @media (max-width: 768px) {
      :root {
        --sidebar-w: 0px;
      }
      #sidebar { display: none; }
      #search-bar { left: 0; }
      #main-content { margin-left: 0; padding: 20px 14px 60px; }
      .fish-grid, .equip-grid, .world-map, .char-grid, .npc-grid, .weather-grid, .celestial-grid, .attr-grid {
        grid-template-columns: 1fr;
      }
      #mobile-menu-btn { display: flex; }
      .header-nav { display: none; }
      .hero-title { font-size: 14px; }
    }
    @media (min-width: 769px) {
      #mobile-menu-btn { display: none; }
    }

    /* SCROLLBAR */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(79,195,247,0.15); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(79,195,247,0.25); }

    input[type="file"] { display: none; }
    .tint-indicator { display: none; }
  </style>
</head>
<body>
  <div id="ocean-bg">
    <div id="ocean-bg-overlay"></div>
  </div>

  <!-- HEADER -->
  <header id="top-header">
    <button id="mobile-menu-btn" style="background:none;border:none;color:var(--accent);cursor:pointer;padding:4px;" data-testid="button-mobile-menu">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12h18M3 6h18M3 18h18"/></svg>
    </button>
    <span class="logo-text">GRUDGE ANGELER</span>
    <nav class="header-nav">
      <a href="/" data-testid="link-home">Home</a>
      <a href="/game" data-testid="link-play-game">Play Game</a>
      <a href="/codex" data-testid="link-legendary-codex">Legendary Codex</a>
    </nav>
  </header>

  <!-- SIDEBAR -->
  <nav id="sidebar">
    <div class="sidebar-label">ENCYCLOPEDIA</div>
  </nav>

  <!-- SEARCH -->
  <div id="search-bar">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
    <input type="text" id="search-input" placeholder="Search fish, equipment, zones..." data-testid="input-search" />
    <span id="search-count"></span>
  </div>

  <!-- MAIN -->
  <main id="main-content">
    <div class="hero-area">
      <img src="/assets/logo.png" alt="Grudge Angeler" onerror="this.style.display='none'" style="max-width:80px;margin-bottom:10px;">
      <div class="hero-title">GAME ENCYCLOPEDIA</div>
      <div class="hero-sub">All species, equipment, characters & world data</div>
      <div class="legend-row">
        <div class="legend-item"><div class="legend-dot" style="background:var(--common)"></div>Common</div>
        <div class="legend-item"><div class="legend-dot" style="background:var(--uncommon)"></div>Uncommon</div>
        <div class="legend-item"><div class="legend-dot" style="background:var(--rare)"></div>Rare</div>
        <div class="legend-item"><div class="legend-dot" style="background:var(--epic)"></div>Epic</div>
        <div class="legend-item"><div class="legend-dot" style="background:var(--legendary)"></div>Legendary</div>
        <div class="legend-item"><div class="legend-dot" style="background:var(--ultra-rare)"></div>Ultra Rare</div>
      </div>
    </div>

    <div id="sections-container"></div>

    <div class="deep-ocean-trench" data-testid="deep-ocean-trench">
      <div class="trench-title">THE DEEPEST REACH</div>
      <div class="trench-desc">Below the abyss, past where light has any meaning, lies the seam between the ocean and something older. Only the most determined anglers will ever cast a line this deep.</div>
      <div class="hidden-treasure" data-testid="hidden-treasure-chest">
        <img src="/assets/chest/closed.png" alt="Hidden Treasure Chest">
        <div class="treasure-label">THE DEEPEST TREASURE</div>
      </div>
    </div>

    <div class="footer">GRUDGE ANGELER ENCYCLOPEDIA v4.0</div>
  </main>

  <button id="back-to-top" data-testid="button-back-to-top" title="Back to top">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M18 15l-6-6-6 6"/></svg>
  </button>

  <input type="file" id="img-upload" accept="image/*" />

<script>
(function() {
  var bubbleCount = 14;
  var bgEl = document.getElementById('ocean-bg');
  for (var i = 0; i < bubbleCount; i++) {
    var b = document.createElement('div');
    b.className = 'bubble';
    var size = 3 + Math.random() * 10;
    b.style.width = size + 'px';
    b.style.height = size + 'px';
    b.style.left = (Math.random() * 100) + '%';
    b.style.bottom = -(Math.random() * 20) + '%';
    b.style.animationDuration = (12 + Math.random() * 20) + 's';
    b.style.animationDelay = (Math.random() * 15) + 's';
    bgEl.appendChild(b);
  }
})();

var FISH_SILHOUETTE = '<svg viewBox="0 0 48 32" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M4 16c0-4 3-8 8-10 3-1 7-1 12 0 4 1 8 3 11 5l5 5-5 5c-3 2-7 4-11 5-5 1-9 1-12 0C7 24 4 20 4 16z"/><path d="M2 12l-1 4 1 4 2-4-2-4z" opacity="0.6"/><circle cx="32" cy="14" r="2" fill="rgba(0,0,0,0.3)"/></svg>';

var FISH_SPECIES = [
  { name: "Minnow", img: "/assets/icons/fish/minnow-silver-common.png", points: 10, rarity: "common", weight: 40, minDepth: 0.15, speed: 1.5, description: "A tiny silver fish, common in shallow waters.", zone: "Shallow" },
  { name: "Jellyfish", img: "/assets/icons/fish/jellyfish-translucent-common.png", points: 20, rarity: "common", weight: 25, minDepth: 0.2, speed: 0.7, description: "A translucent jellyfish drifting with the current.", zone: "Shallow" },
  { name: "Perch", img: "/assets/icons/fish/perch-striped-common.png", points: 25, rarity: "common", weight: 30, minDepth: 0.25, speed: 1.2, description: "A striped freshwater fish with sharp fins.", zone: "Shallow" },
  { name: "Eel", img: "/assets/icons/fish/eel-dark-common.png", points: 40, rarity: "common", weight: 20, minDepth: 0.3, speed: 1.3, description: "A slippery serpentine fish.", zone: "Shallow-Mid" },
  { name: "Octopus", img: "/assets/icons/fish/octopus-red-common.png", points: 35, rarity: "common", weight: 15, minDepth: 0.25, speed: 0.9, description: "A clever red octopus with grasping tentacles.", zone: "Shallow" },
  { name: "Freshwater Bass", img: "/assets/icons/fish/Icons_05.png", points: 15, rarity: "common", weight: 35, minDepth: 0.15, speed: 1.1, description: "A green freshwater bass. Common but scrappy.", zone: "Shallow" },
  { name: "Anchovy", img: "/assets/icons/fish/Icons_06.png", points: 12, rarity: "common", weight: 40, minDepth: 0.2, speed: 1.6, description: "A darting blue anchovy. Travels in huge schools.", zone: "Shallow" },
  { name: "Sea Urchin", img: "/assets/fish-images/sea-urchin.png", points: 15, rarity: "common", weight: 20, minDepth: 0.2, speed: 0.3, description: "A spiny sea urchin crawling along the ocean floor.", zone: "Shallow" },
  { name: "Bass", img: "/assets/icons/fish/bass-green-uncommon.png", points: 50, rarity: "uncommon", weight: 15, minDepth: 0.35, speed: 1.0, description: "A strong fighter popular with anglers.", zone: "Mid" },
  { name: "Catfish", img: "/assets/icons/fish/catfish-brown-uncommon.png", points: 75, rarity: "uncommon", weight: 8, minDepth: 0.45, speed: 0.8, description: "A bottom-dweller with long whiskers.", zone: "Mid" },
  { name: "Salmon", img: "/assets/icons/fish/salmon-pink-uncommon.png", points: 60, rarity: "uncommon", weight: 12, minDepth: 0.35, speed: 1.1, description: "A prized pink-fleshed fish.", zone: "Mid" },
  { name: "Electric Eel", img: "/assets/icons/fish/electric-eel-yellow-uncommon.png", points: 65, rarity: "uncommon", weight: 10, minDepth: 0.4, speed: 1.6, description: "A shocking eel crackling with electric charge.", zone: "Mid" },
  { name: "Blue Ring Octopus", img: "/assets/icons/fish/blue-ring-octopus-blue-uncommon.png", points: 55, rarity: "uncommon", weight: 8, minDepth: 0.35, speed: 1.0, description: "A small but deadly octopus with glowing blue rings.", zone: "Mid" },
  { name: "Giant Octopus", img: "/assets/icons/fish/giant-octopus-purple-legendary.png", points: 70, rarity: "uncommon", weight: 10, minDepth: 0.4, speed: 0.6, description: "A purple giant with eight crushing arms. Incredibly intelligent.", zone: "Mid-Deep" },
  { name: "Redfish", img: "/assets/icons/fish/Icons_07.png", points: 55, rarity: "uncommon", weight: 12, minDepth: 0.3, speed: 1.0, description: "A rust-red ocean fish with a powerful tail.", zone: "Mid" },
  { name: "Angelfish", img: "/assets/icons/fish/Icons_10.png", points: 65, rarity: "uncommon", weight: 10, minDepth: 0.35, speed: 0.9, description: "A graceful pink angelfish with flowing fins.", zone: "Mid" },
  { name: "Surgeonfish", img: "/assets/icons/fish/Icons_09.png", points: 70, rarity: "uncommon", weight: 8, minDepth: 0.45, speed: 1.3, description: "A large blue surgeonfish with a razor-sharp tail spine.", zone: "Mid" },
  { name: "Clownfish", img: "/assets/fish-images/clownfish-salt-uncommon.png", points: 45, rarity: "uncommon", weight: 14, minDepth: 0.25, speed: 1.0, description: "A bright orange clownfish hiding among anemones.", zone: "Shallow" },
  { name: "Butterfly Fish", img: "/assets/fish-images/butterfly-fish.png", points: 55, rarity: "uncommon", weight: 12, minDepth: 0.2, speed: 1.3, description: "A golden butterfly fish with striking blue markings.", zone: "Shallow" },
  { name: "Pink Jellyfish", img: "/assets/fish-images/pink-jellyfish.png", points: 40, rarity: "uncommon", weight: 15, minDepth: 0.3, speed: 0.6, description: "A pink jellyfish pulsing gracefully through the water.", zone: "Mid" },
  { name: "Whale", img: "/assets/icons/fish/whale-blue-legendary.png", points: 300, rarity: "legendary", weight: 1, minDepth: 0.65, speed: 0.5, description: "The king of the deep. Incredibly rare!", zone: "Deep Ocean" },
  { name: "Kraken", img: "/assets/icons/fish/kraken-crimson-legendary.png", points: 400, rarity: "legendary", weight: 0.8, minDepth: 0.7, speed: 0.7, description: "A crimson terror from the deep. Its tentacles crush ships.", zone: "Deep Ocean" },
  { name: "Hammerhead Shark", img: "/assets/fish-images/hammerhead-shark.png", points: 350, rarity: "legendary", weight: 0.8, minDepth: 0.6, speed: 2.0, description: "A massive hammerhead shark. Its wide head detects prey with uncanny precision.", zone: "Deep Ocean" },
];

var RARE_FISH = [
  { name: "Swordfish", img: "/assets/icons/fish/swordfish-blue-rare.png", points: 150, rarity: "rare", weight: 4, minDepth: 0.55, speed: 1.8, description: "A powerful ocean predator with a sharp bill.", zone: "Deep" },
  { name: "Stingray", img: "/assets/icons/fish/stingray-gray-rare.png", points: 100, rarity: "rare", weight: 5, minDepth: 0.45, speed: 1.4, description: "A flat-bodied ray gliding silently along the ocean floor.", zone: "Mid" },
  { name: "Moray Eel", img: "/assets/icons/fish/moray-eel-brown-rare.png", points: 90, rarity: "rare", weight: 6, minDepth: 0.5, speed: 1.1, description: "A thick-bodied eel lurking in reef crevices.", zone: "Mid-Deep" },
  { name: "Anglerfish", img: "/assets/icons/fish/anglerfish-dark-rare.png", points: 120, rarity: "rare", weight: 5, minDepth: 0.55, speed: 0.6, description: "A deep-sea predator with a bioluminescent lure.", zone: "Deep" },
  { name: "Deep Sea Angler", img: "/assets/icons/fish/deep-sea-angler-dark-rare.png", points: 140, rarity: "rare", weight: 3, minDepth: 0.65, speed: 0.5, description: "A pitch-black anglerfish with a sinister yellow glow.", zone: "Deep Ocean" },
  { name: "Giant Squid", img: "/assets/icons/fish/giant-squid-blue-legendary.png", points: 130, rarity: "rare", weight: 4, minDepth: 0.55, speed: 0.8, description: "A massive blue squid from the abyss. Eyes the size of dinner plates.", zone: "Deep Ocean" },
  { name: "Pufferfish", img: "/assets/fish-images/pufferfish-salt-rare.png", points: 110, rarity: "rare", weight: 6, minDepth: 0.4, speed: 0.7, description: "A spotted pufferfish. Inflates when threatened.", zone: "Mid" },
  { name: "Rainbow Trout", img: "/assets/icons/fish/Icons_08.png", points: 95, rarity: "rare", weight: 5, minDepth: 0.35, speed: 1.2, description: "A speckled brown trout with a rainbow shimmer along its flank.", zone: "Mid" },
  { name: "Lionfish", img: "/assets/fish-images/lionfish.png", points: 130, rarity: "rare", weight: 4, minDepth: 0.45, speed: 0.8, description: "A venomous lionfish with elaborate striped fins. Beautiful but deadly.", zone: "Mid-Deep" },
  { name: "Purple Jellyfish", img: "/assets/fish-images/purple-jellyfish.png", points: 85, rarity: "rare", weight: 5, minDepth: 0.5, speed: 0.5, description: "A majestic purple jellyfish trailing long, luminous tentacles.", zone: "Mid-Deep" },
];

var ULTRA_RARE_FISH = [
  { name: "Phantom Minnow", img: "/assets/icons/fish/phantom-minnow-spectral-ultra_rare.png", points: 500, rarity: "ultra_rare", weight: 0.3, minDepth: 0.55, speed: 2.2, description: "A ghostly minnow wreathed in spectral flame.", zone: "Deep", stars: 5 },
  { name: "Volcanic Perch", img: "/assets/icons/fish/volcanic-perch-molten-ultra_rare.png", points: 600, rarity: "ultra_rare", weight: 0.25, minDepth: 0.6, speed: 1.6, description: "A perch superheated by deep-sea vents.", zone: "Deep Ocean", stars: 5 },
  { name: "Abyssal Bass", img: "/assets/icons/fish/abyssal-bass-dark-ultra_rare.png", points: 750, rarity: "ultra_rare", weight: 0.2, minDepth: 0.65, speed: 1.4, description: "A colossal bass from the deepest trenches.", zone: "Abyss", stars: 5 },
  { name: "Frost Catfish", img: "/assets/icons/fish/frost-catfish-ice-ultra_rare.png", points: 800, rarity: "ultra_rare", weight: 0.18, minDepth: 0.6, speed: 0.9, description: "An ancient catfish encased in living ice.", zone: "Deep Ocean", stars: 5 },
  { name: "Storm Swordfish", img: "/assets/icons/fish/storm-swordfish-electric-ultra_rare.png", points: 1000, rarity: "ultra_rare", weight: 0.12, minDepth: 0.7, speed: 2.5, description: "A swordfish that rides lightning bolts.", zone: "Deep Ocean", stars: 5 },
  { name: "Celestial Whale", img: "/assets/icons/fish/celestial-whale-cosmic-ultra_rare.png", points: 2000, rarity: "ultra_rare", weight: 0.05, minDepth: 0.75, speed: 0.4, description: "A cosmic whale that swallowed a dying star.", zone: "Abyss", stars: 5 },
  { name: "Neon Eel", img: "/assets/icons/fish/neon-eel-neon-ultra_rare.png", points: 650, rarity: "ultra_rare", weight: 0.22, minDepth: 0.55, speed: 1.9, description: "A bioluminescent eel pulsing with neon colors.", zone: "Deep", stars: 5 },
  { name: "Golden Salmon", img: "/assets/icons/fish/golden-salmon-gold-ultra_rare.png", points: 700, rarity: "ultra_rare", weight: 0.2, minDepth: 0.6, speed: 1.5, description: "A legendary salmon with solid gold scales.", zone: "Deep Ocean", stars: 5 },
  { name: "Shadow Leviathan", img: "/assets/icons/fish/shadow-leviathan-shadow-ultra_rare.png", points: 1500, rarity: "ultra_rare", weight: 0.08, minDepth: 0.8, speed: 0.6, description: "A titanic shadow beast from beyond the abyss.", zone: "Abyss", stars: 5 },
  { name: "The Seal at the Seam", img: "/assets/grudge_logo.png", points: 5000, rarity: "ultra_rare", weight: 0.01, minDepth: 0.99, speed: 0.1, description: "The 10th Legendary. A living sigil found at the deepest seam of reality.", zone: "The Seam", stars: 5 },
];

var BEACH_CRABS = [
  { name: "Red Crab", img: "/assets/icons/fish/red-crab-red-common.png", points: 8, rarity: "common", weight: 50, description: "A small red crab that scuttles along the beach.", zone: "Beach" },
  { name: "Blue Crab", img: "/assets/icons/fish/blue-crab-blue-common.png", points: 10, rarity: "common", weight: 40, description: "A bright blue crab found near tidal pools.", zone: "Beach" },
  { name: "Green Crab", img: "/assets/icons/fish/green-crab-green-common.png", points: 8, rarity: "common", weight: 45, description: "A mossy green crab hiding in the seaweed.", zone: "Beach" },
  { name: "Cyan Crab", img: "/assets/icons/fish/cyan-crab-cyan-common.png", points: 8, rarity: "common", weight: 45, description: "A pale cyan crab commonly found on sandy shores.", zone: "Beach" },
  { name: "Pink Crab", img: "/assets/icons/fish/pink-crab-pink-common.png", points: 12, rarity: "common", weight: 35, description: "A cute pink crab that loves warm shallow waters.", zone: "Beach" },
  { name: "Purple Crab", img: "/assets/icons/fish/purple-crab-purple-uncommon.png", points: 15, rarity: "uncommon", weight: 20, description: "An uncommon purple crab with iridescent shell.", zone: "Beach" },
  { name: "Gold Crab", img: "/assets/icons/fish/gold-crab-gold-uncommon.png", points: 25, rarity: "uncommon", weight: 15, description: "A rare golden crab. Prized for its shimmering shell.", zone: "Beach" },
  { name: "Dark Crab", img: "/assets/icons/fish/dark-crab-dark-uncommon.png", points: 20, rarity: "uncommon", weight: 18, description: "A dark-shelled crab with powerful pincers.", zone: "Beach" },
  { name: "Crimson Crab", img: "/assets/icons/fish/crimson-crab-crimson-rare.png", points: 40, rarity: "rare", weight: 8, description: "A blood-red crab with Sea Devil markings. Extremely aggressive.", zone: "Beach" },
  { name: "Shadow Crab", img: "/assets/icons/fish/shadow-crab-shadow-rare.png", points: 55, rarity: "rare", weight: 5, description: "A dark maroon crab that moves like a phantom. Kin of the Sea Devil.", zone: "Beach" },
];

var PREDATORS = [
  { name: "Shark", img: "/assets/icons/fish/shark-predator.png", points: 400, rarity: "rare", weight: 3, speed: 2.2, description: "A fearsome shark prowling the deep waters. Patrols territory, chases fish and players. Only appears in Deep Waters (Zone 3+).", zone: "Deep Waters+", scareRadius: 200 },
  { name: "Kraken", img: "/assets/icons/fish/kraken-predator.png", points: 800, rarity: "legendary", weight: 1, speed: 1.5, description: "A massive squid from the abyss. Enormous scare radius drives fish away. Only appears in The Abyss (Zone 4+).", zone: "Abyss Only", scareRadius: 280 },
  { name: "Sea Devil", img: "/assets/icons/fish/sea-devil-predator.png", points: 600, rarity: "rare", weight: 2, speed: 1.8, description: "A monstrous crab creature from the deep trenches. Ambush predator. Only appears in Deep Waters (Zone 3+).", zone: "Deep Waters+", scareRadius: 240 },
];

var RODS = [
  { name: "Bamboo Rod", price: 0, catchZoneBonus: 0, reelSpeedMult: 1.0, lineStrength: 1.0, description: "A simple bamboo rod. Short range, slow sink.", icon: "/assets/icons/rods/rod-bamboo.png", castRange: 350, sinkSpeed: 1.0 },
  { name: "Fiberglass Rod", price: 150, catchZoneBonus: 0.015, reelSpeedMult: 1.1, lineStrength: 1.15, description: "Lighter and more responsive. Better range.", icon: "/assets/icons/rods/rod-fiberglass.png", castRange: 550, sinkSpeed: 1.3 },
  { name: "Carbon Rod", price: 400, catchZoneBonus: 0.025, reelSpeedMult: 1.2, lineStrength: 1.3, description: "High-tech carbon fiber. Reaches deep water.", icon: "/assets/icons/rods/rod-carbon.png", castRange: 800, sinkSpeed: 1.6 },
  { name: "Titanium Rod", price: 800, catchZoneBonus: 0.035, reelSpeedMult: 1.35, lineStrength: 1.5, description: "Ultra-strong titanium. Massive cast range.", icon: "/assets/icons/rods/rod-titanium.png", castRange: 1100, sinkSpeed: 2.0 },
  { name: "Legendary Rod", price: 1500, catchZoneBonus: 0.05, reelSpeedMult: 1.5, lineStrength: 1.8, description: "Forged from a ghost ship anchor. No limits.", icon: "/assets/icons/rods/rod-legendary.png", castRange: 1500, sinkSpeed: 2.5 },
];

var LURES = [
  { name: "Basic Worm", price: 0, description: "A plain earthworm. The classic bait.", icon: "/assets/icons/lures/worm.png", rarityBoost: 1.0, type: "live", targets: "All fish" },
  { name: "Nightcrawler", price: 40, description: "A fat, juicy nightcrawler. Fish can't resist the wriggle.", icon: "/assets/icons/lures/nightcrawler.png", rarityBoost: 1.0, type: "live", targets: "Catfish, Bass" },
  { name: "Leech", price: 90, description: "A slimy leech that bottom dwellers love. Sinks a bit faster.", icon: "/assets/icons/lures/leech.png", rarityBoost: 1.2, type: "live", targets: "Catfish, Eel, Moray Eel, Electric Eel" },
  { name: "Maggots", price: 60, description: "A cluster of wriggling maggots. Small fish go crazy.", icon: "/assets/icons/lures/maggots.png", rarityBoost: 1.0, type: "live", targets: "Minnow, Perch, Jellyfish" },
  { name: "Minnow Bait", price: 150, description: "A live minnow on the hook. Big predators can't resist.", icon: "/assets/icons/lures/minnow_bait.png", rarityBoost: 1.5, type: "live", targets: "Bass, Salmon, Swordfish" },
  { name: "Beginner Lure", price: 50, description: "A basic crankbait for beginners. Better than bare hooks.", icon: "/assets/icons/lures/beginner_lure.png", rarityBoost: 1.0, type: "lure", targets: "All fish" },
  { name: "Crankbait", price: 120, description: "A fat-bodied diving lure with a rattling action.", icon: "/assets/icons/lures/crankbait.png", rarityBoost: 1.1, type: "lure", targets: "Perch, Bass" },
  { name: "Silver Spoon", price: 100, description: "A hammered metal spoon that flashes in the water.", icon: "/assets/icons/lures/spoon.png", rarityBoost: 1.0, type: "lure", targets: "Salmon, Minnow" },
  { name: "Grub Worm", price: 80, description: "A soft plastic grub with a curly tail. Works on everything.", icon: "/assets/icons/lures/grub_worm.png", rarityBoost: 1.1, type: "lure", targets: "All fish" },
  { name: "Spinnerbait", price: 200, description: "Spinning blades create flash and vibration underwater.", icon: "/assets/icons/lures/spinnerbait.png", rarityBoost: 1.3, type: "lure", targets: "Bass, Perch" },
  { name: "Deep Diver", price: 180, description: "Heavy diving lure. Sinks fast to reach bottom dwellers.", icon: "/assets/icons/lures/deep_diver.png", rarityBoost: 1.2, type: "lure", targets: "Catfish, Eel, Anglerfish, Deep Sea Angler" },
  { name: "Golden Fly", price: 250, description: "An iridescent golden fly. Rare fish can't resist.", icon: "/assets/icons/lures/golden_fly.png", rarityBoost: 2.0, type: "lure", targets: "Swordfish" },
  { name: "Glow Jig", price: 350, description: "Bioluminescent lure. Sinks deep, attracts larger specimens.", icon: "/assets/icons/lures/glow_jig.png", rarityBoost: 1.3, type: "lure", targets: "All deep fish" },
  { name: "Storm Shad", price: 300, description: "Mimics injured baitfish. Fish bite faster.", icon: "/assets/icons/lures/storm_shad.png", rarityBoost: 1.0, type: "lure", targets: "Bass, Salmon" },
  { name: "Kraken Bait", price: 500, description: "Mysterious bait from the depths. Sinks to the abyss.", icon: "/assets/icons/lures/kraken_bait.png", rarityBoost: 3.0, type: "lure", targets: "Whale" },
  { name: "Prismatic Lure", price: 750, description: "A rainbow-shifting lure. Boosts everything.", icon: "/assets/icons/lures/prismatic_lure.png", rarityBoost: 1.8, type: "lure", targets: "All fish" },
];

var CRAB_BAITS = [
  { name: "Common Crab Bait", price: 0, description: "Live crab bait from common beach crabs. Required to attract legendary fish.", icon: "/assets/icons/fish/red-crab-red-common.png", tier: "Tier 1", legendaryBoost: "1.5x", rarityBoost: 1.5, type: "crab_bait" },
  { name: "Uncommon Crab Bait", price: 0, description: "Live crab bait from uncommon crabs. Legendaries can't resist the scent.", icon: "/assets/icons/fish/purple-crab-purple-uncommon.png", tier: "Tier 2", legendaryBoost: "3.0x", rarityBoost: 2.5, type: "crab_bait" },
  { name: "Rare Crab Bait", price: 0, description: "Live rare crab bait. The ultimate legendary attractor. Sea Devil kin call to the deep.", icon: "/assets/icons/fish/crimson-crab-crimson-rare.png", tier: "Tier 3", legendaryBoost: "6.0x", rarityBoost: 4.0, type: "crab_bait" },
];

var CHUM_ITEMS = [
  { name: "Fish Scraps", price: 15, description: "Basic chum. A slight fish attract.", icon: "/assets/icons/chum/chum-fish-guts.png", duration: "5min" },
  { name: "Bread Crumbs", price: 20, description: "Attracts small fish nearby.", icon: "/assets/icons/chum/chum-bread-crumbs.png", duration: "5.8min" },
  { name: "Corn Mash", price: 25, description: "Attracts bottom feeders.", icon: "/assets/icons/chum/chum-worm-bait.png", duration: "6.7min" },
  { name: "Blood Meal", price: 40, description: "Attracts predators with its scent.", icon: "/assets/icons/chum/chum-blood-worm-extract.png", duration: "5.8min" },
  { name: "Shrimp Paste", price: 50, description: "Good all-around chum.", icon: "/assets/icons/chum/chum-shrimp-paste.png", duration: "6.7min" },
  { name: "Squid Ink", price: 60, description: "Attracts deep fish.", icon: "/assets/icons/chum/chum-squid-ink.png", duration: "5.8min" },
  { name: "Fish Oil Slick", price: 75, description: "Wide area attract effect.", icon: "/assets/icons/chum/chum-sardine-oil.png", duration: "8.3min" },
  { name: "Sardine Chunks", price: 45, description: "Fast bite speed boost.", icon: "/assets/icons/chum/chum-live-shrimp.png", duration: "5min" },
  { name: "Crab Guts", price: 55, description: "Attracts rare fish.", icon: "/assets/icons/chum/chum-sea-urchin-spines.png", duration: "5.8min" },
  { name: "Mussel Mix", price: 35, description: "Steady and reliable attract.", icon: "/assets/icons/chum/chum-jellyfish-jelly.png", duration: "7.5min" },
  { name: "Fermented Brine", price: 80, description: "Strong rarity boost.", icon: "/assets/icons/chum/chum-deep-pressure.png", duration: "6.7min" },
  { name: "Whale Blubber", price: 100, description: "Pulls legendary fish to shallower depths.", icon: "/assets/icons/chum/chum-whale-blubber.png", duration: "5.8min" },
  { name: "Phosphor Dust", price: 120, description: "Glowing effect pulls ultra rares up.", icon: "/assets/icons/chum/chum-glowing-plankton.png", duration: "5min" },
  { name: "Coral Powder", price: 90, description: "Attracts reef fish.", icon: "/assets/icons/chum/chum-coral-dust.png", duration: "6.7min" },
  { name: "Deep Sea Extract", price: 150, description: "Massive depth pull. Deep fish swim up.", icon: "/assets/icons/chum/chum-electric-plankton.png", duration: "5.8min" },
  { name: "Thunder Chum", price: 130, description: "Attracts storm fish from the depths.", icon: "/assets/icons/chum/chum-thunder.png", duration: "5min" },
  { name: "Moonlight Essence", price: 200, description: "Celestial pull. Brings abyss fish to you.", icon: "/assets/icons/chum/chum-moonlight-essence.png", duration: "6.7min" },
  { name: "Kraken Bile", price: 180, description: "Massive rarity, strong depth pull.", icon: "/assets/icons/chum/chum-kraken-bile.png", duration: "5min" },
  { name: "Golden Flakes", price: 250, description: "Boosts everything. Strong depth pull.", icon: "/assets/icons/chum/chum-golden-flakes.png", duration: "8.3min" },
  { name: "Abyssal Ooze", price: 300, description: "The ultimate chum. Pulls abyss fish to surface.", icon: "/assets/icons/chum/chum-abyssal-ooze.png", duration: "10min" },
  { name: "Live Shrimp Cluster", price: 0, description: "Caught live shrimp. Good bait for medium fish.", icon: "/assets/icons/chum/chum-live-shrimp.png", duration: "4.2min" },
  { name: "Glowing Plankton", price: 0, description: "Caught glowing plankton. Attracts rare fish.", icon: "/assets/icons/chum/chum-glowing-plankton.png", duration: "3.3min" },
];

var WORLD_ZONES = [
  { name: "Sandy Beach", depth: "0-5m", color: "#e8c478", desc: "Warm shallow waters with crabs and minnows.", fish: "Crabs, Minnow" },
  { name: "Shallow Waters", depth: "5-20m", color: "#64b5f6", desc: "Clear waters teeming with common fish.", fish: "Minnow, Perch, Eel" },
  { name: "Rocky Shore", depth: "20-50m", color: "#78909c", desc: "Rocky outcrops with reef dwellers.", fish: "Perch, Bass, Triggerfish" },
  { name: "Open Ocean", depth: "50-150m", color: "#42a5f5", desc: "Vast open waters. Home to game fish.", fish: "Bass, Salmon, Catfish, Tuna" },
  { name: "Deep Waters", depth: "150-500m", color: "#1565c0", desc: "Dark and cold. Rare species lurk here.", fish: "Swordfish, Marlin, Shark" },
  { name: "Twilight Zone", depth: "500-1000m", color: "#0d47a1", desc: "Minimal light. Epic creatures emerge.", fish: "Giant Squid, Oarfish, Goblin Shark" },
  { name: "Midnight Zone", depth: "1000-3000m", color: "#1a237e", desc: "Total darkness. Bioluminescent horrors.", fish: "Dragonfish, Vampire Squid, Coelacanth" },
  { name: "The Abyss", depth: "3000m+", color: "#0a1929", desc: "The deepest reach. Legendary fish only.", fish: "Ultra Rare, The Seal at the Seam" },
];

var CHARACTERS = [
  { name: "Fabled", img: "/assets/fisherman/fabled/Idle.png", color: "#64b5f6", desc: "The balanced faction. Traditional anglers with steady hands." },
  { name: "Legion", img: "/assets/fisherman/legion/Idle.png", color: "#ef5350", desc: "The aggressive faction. Power reelers who fight every catch." },
  { name: "Crusade", img: "/assets/fisherman/crusade/Idle.png", color: "#66bb6a", desc: "The patient faction. Strategic anglers who wait for the perfect moment." },
];

var WEATHER_TYPES = [
  { name: "Clear", color: "#ffd54f", desc: "Bright and sunny. Standard fishing conditions.", effect: "Normal spawn rates" },
  { name: "Cloudy", color: "#90a4ae", desc: "Overcast skies. Slightly better for rare fish.", effect: "+10% rare spawn" },
  { name: "Rain", color: "#64b5f6", desc: "Rainfall increases surface activity.", effect: "+20% bite speed, rare fish surface" },
  { name: "Storm", color: "#7c4dff", desc: "Dangerous conditions. Lightning and massive waves.", effect: "+40% rare, predators more active" },
  { name: "Fog", color: "#b0bec5", desc: "Reduced visibility. Mysterious spawns increase.", effect: "+15% epic spawn, reduced visibility" },
];

var CELESTIAL_EVENTS = [
  { name: "Red Sun", color: "#ff5252", bgColor: "rgba(40,5,5,0.8)", borderColor: "rgba(255,82,82,0.3)", desc: "The sun turns crimson. Fire fish emerge from the depths.", boost: "2x fire-type fish spawns" },
  { name: "Green Moon", color: "#69f0ae", bgColor: "rgba(5,30,15,0.8)", borderColor: "rgba(105,240,174,0.3)", desc: "An eerie green moon rises. Nature fish awaken.", boost: "2x nature-type fish, aurora borealis" },
  { name: "Tentacle Sun", color: "#e040fb", bgColor: "rgba(30,5,40,0.8)", borderColor: "rgba(224,64,251,0.3)", desc: "Eldritch tentacles reach from the sun. Deep horrors surface.", boost: "3x epic spawn, Kraken guaranteed" },
  { name: "Blood Moon", color: "#ff1744", bgColor: "rgba(40,0,10,0.8)", borderColor: "rgba(255,23,68,0.3)", desc: "The moon bleeds red. All predators become hyper-aggressive.", boost: "2x all rare+, predator frenzy" },
];

var ATTRIBUTES = [
  { name: "Tactics", color: "#42a5f5", desc: "Strategic mind for optimal positioning.", effect: "Improves catch zone placement" },
  { name: "Strength", color: "#ef5350", desc: "Raw physical power for reeling.", effect: "Faster reel speed, stronger line" },
  { name: "Agility", color: "#66bb6a", desc: "Quick reflexes for timing bites.", effect: "Faster catch zone movement" },
  { name: "Dexterity", color: "#ffa726", desc: "Precise control of casting and reeling.", effect: "Smoother reel control" },
  { name: "Endurance", color: "#ab47bc", desc: "Stamina for long fishing sessions.", effect: "Slower stamina drain" },
  { name: "Vitality", color: "#26c6da", desc: "Health and resilience against predators.", effect: "More HP, faster recovery" },
  { name: "Wisdom", color: "#ffd54f", desc: "Knowledge of fish behavior and patterns.", effect: "Better rarity spawns" },
  { name: "Intellect", color: "#7e57c2", desc: "Understanding of equipment and upgrades.", effect: "Better equipment bonuses" },
];

var NPCS = [
  { name: "Old Pete", img: "/assets/npcs/1/Idle.png", role: "shopkeeper", desc: "Sells rare chum and lures. Fair prices for a man of the sea.", interact: "Press E near the dock" },
  { name: "Captain Mira", img: "/assets/npcs/2/Idle.png", role: "mission_giver", desc: "Challenges anglers to catch specific fish by weight.", interact: "Press E at the pier end" },
  { name: "The Collector", img: "/assets/npcs/3/Idle.png", role: "requester", desc: "Requests specific fish types with quantity goals.", interact: "Press E near the hut" },
  { name: "Bait Boy", img: "/assets/npcs/4/Idle.png", role: "shopkeeper", desc: "Young vendor selling live baits at discount prices.", interact: "Press E near the barrel" },
  { name: "Sea Witch", img: "/assets/npcs/5/Idle.png", role: "mission_giver", desc: "Mysterious figure offering legendary fish bounties.", interact: "Press E at the dock corner" },
];

var MECHANICS = [
  { title: "Casting", desc: "Hold and release mouse to cast your line. Cast distance depends on hold duration." },
  { title: "Reeling", desc: "Once a fish bites, a minigame begins. Keep the catch zone over the fish indicator." },
  { title: "Force Bar", desc: "Hold SPACE to actively reel in. Builds tension but risks line breakage." },
  { title: "Resilience Bar", desc: "Hold S to let out line. Reduces tension and prevents snapping." },
  { title: "Net Fishing", desc: "Select net from hotbar. Cast it to auto-catch nearby fish." },
  { title: "Swimming", desc: "Jump into water to swim. Explore underwater areas and find secrets." },
  { title: "Boat System", desc: "Board the boat to fish in deep ocean areas. Unique mechanics." },
  { title: "Day/Night Cycle", desc: "30-minute cycle affects fish spawns and visibility." },
  { title: "Combo System", desc: "Catch fish quickly in succession to build combo multipliers." },
  { title: "Rod Leveling", desc: "Rods gain XP with each catch and level up for better stats." },
  { title: "Collection Log", desc: "Track every species you've caught. Complete it for rewards." },
  { title: "Bounty Board", desc: "Accept bounties for specific fish. Earn bonus gbux." },
  { title: "Shop System", desc: "Buy equipment from the shop. Press E near shop NPCs." },
  { title: "Chum Throwing", desc: "Select chum from hotbar slot 3. Click to throw into water." },
  { title: "Binoculars", desc: "Hotkey 5. Free-look camera mode for scouting fish." },
  { title: "Predator Avoidance", desc: "Watch for sharks, kraken, and sea devils. They can damage you." },
];

var RARITY_INFO = [
  { title: "Common", color: "var(--common)", desc: "Found everywhere. 1x sell multiplier. Easy to catch." },
  { title: "Uncommon", color: "var(--uncommon)", desc: "Slightly harder to find. 2x sell multiplier. Moderate reel difficulty." },
  { title: "Rare", color: "var(--rare)", desc: "Requires deeper waters. 4x sell multiplier. Challenging reeling." },
  { title: "Epic", color: "var(--epic)", desc: "Deep ocean only. 8x sell multiplier. Very hard to reel." },
  { title: "Legendary", color: "var(--legendary)", desc: "Extremely rare. 15x sell multiplier. Expert-level catches." },
  { title: "Ultra Rare", color: "var(--ultra-rare)", desc: "The Legendary 10. 50x sell multiplier. Near-impossible conditions." },
];

var LEADERBOARD_INFO = [
  { title: "Biggest Single Catch", desc: "Ranked by fish weight. Catch the heaviest fish to claim the top spot." },
  { title: "Most Catches (20-Min Session)", desc: "Total fish caught in a single 20-minute session. Speed and efficiency matter." },
  { title: "Legendary/Ultra-Rare Catches", desc: "Total legendary and ultra-rare fish caught. The ultimate achievement." },
];

var RARITY_COLORS = { common: "var(--common)", uncommon: "var(--uncommon)", rare: "var(--rare)", epic: "var(--epic)", legendary: "var(--legendary)", ultra_rare: "var(--ultra-rare)" };
var RARITY_LABELS = { common: "COMMON", uncommon: "UNCOMMON", rare: "RARE", epic: "EPIC", legendary: "LEGENDARY", ultra_rare: "ULTRA RARE" };

var SECTIONS_CONFIG = [
  { id: "characters", title: "PLAYABLE CHARACTERS", dot: "#22d3ee", count: "3 FACTIONS", desc: "Choose your character variant at the start. Each faction has unique recolored sprite sets.", gridType: "char" },
  { id: "world-zones", title: "WORLD ZONES", dot: "var(--accent)", count: "8 SCENES", desc: "The world is divided into 8 horizontally scrolling scenes, from sandy beach to abyssal depths.", gridType: "zone" },
  { id: "common-fish", title: "COMMON FISH", dot: "var(--common)", count: "", gridType: "fish", filterRarity: "common" },
  { id: "uncommon-fish", title: "UNCOMMON FISH", dot: "var(--uncommon)", count: "", gridType: "fish", filterRarity: "uncommon" },
  { id: "rare-fish", title: "RARE FISH", dot: "var(--rare)", count: "", gridType: "fish", filterRarity: "rare" },
  { id: "legendary-fish", title: "LEGENDARY FISH", dot: "var(--legendary)", count: "", gridType: "fish", filterRarity: "legendary" },
  { id: "ultra-fish", title: "THE LEGENDARY 10", dot: "var(--ultra-rare)", count: "", variant: "ultra-variant", desc: 'The 10 rarest fish in existence. Read their full lore in the <a href="/codex" style="color:var(--ultra-rare);text-decoration:underline;">Legendary Codex</a>.', gridType: "fish", filterRarity: "ultra_rare" },
  { id: "crabs", title: "BEACH CRABS", dot: "#e57373", count: "10 VARIANTS", desc: "Crabs scuttling along the beach. 10 variants across 3 rarity tiers. All crabs become consumable crab bait when caught.", gridType: "fish", filterRarity: "crab" },
  { id: "predators", title: "OCEAN PREDATORS", dot: "#ef5350", count: "3 SPECIES", variant: "predator-variant", desc: "Dangerous AI-driven predators. Sharks and Sea Devils in Deep Waters (Zone 3+). Kraken only in The Abyss (Zone 4+). No predators in Zones 1-2.", gridType: "fish", filterRarity: "predator" },
  { id: "rods", title: "FISHING RODS", dot: "#81c784", count: "5 RODS", desc: "Each rod improves catch zone size, reel speed, line strength, and cast range.", gridType: "equip" },
  { id: "lures", title: "LURES & BAITS", dot: "#ffb74d", count: "", desc: "5 live baits and 11 artificial lures. Each has unique rarity boosts and target species.", gridType: "equip" },
  { id: "crab-bait", title: "CRAB BAIT SYSTEM", dot: "#ff7043", count: "3 TIERS", variant: "crab-bait-variant", desc: "All caught crabs become consumable live bait. 3 tiers with escalating legendary boosts (1.5x/3.0x/6.0x). Without crab bait, legendary/ultra_rare spawn rates are heavily reduced.", gridType: "crab_bait" },
  { id: "chum", title: "CHUM ITEMS", dot: "#ce93d8", count: "22 ITEMS", desc: "Throwable items that boost fish spawns, rarity, and bite speed. Activate via hotbar.", gridType: "equip" },
  { id: "eggs", title: "BETAXGRUDA EGGS", dot: "#a855f7", count: "7 ITEMS", variant: "egg-variant", desc: 'Special items purchasable only with "Head of Legends." Limited stock worldwide.', gridType: "egg" },
  { id: "weather", title: "WEATHER SYSTEM", dot: "#64b5f6", count: "5 TYPES", desc: "Dynamic weather changes affect fish behavior, bite speed, and visual effects.", gridType: "weather" },
  { id: "celestial", title: "CELESTIAL EVENTS", dot: "#ce93d8", count: "4 EVENTS", variant: "celestial-variant", desc: "Extremely rare cosmic phenomena that dramatically alter spawns.", gridType: "celestial" },
  { id: "attributes", title: "ATTRIBUTE SYSTEM", dot: "var(--gold)", count: "8 STATS", desc: "A physics-inspired attribute model. Distribute points across 8 stats.", gridType: "attr" },
  { id: "npcs", title: "NPC SYSTEM", dot: "#4db6ac", count: "5 NPCS", desc: "Interactive NPCs on the pier. Press E within range to interact.", gridType: "npc" },
  { id: "mechanics", title: "GAME MECHANICS", dot: "var(--accent)", count: "16 SYSTEMS", gridType: "mechanic" },
  { id: "rarity-system", title: "RARITY & ECONOMY", dot: "var(--gold)", count: "", gridType: "rarity" },
  { id: "leaderboard", title: "LEADERBOARD", dot: "#ffd54f", count: "3 CATEGORIES", desc: "Live leaderboard backed by PostgreSQL. Scores auto-submit on each catch.", gridType: "leaderboard" },
];

function getFishData(filterRarity) {
  if (filterRarity === "common") return FISH_SPECIES.filter(function(f) { return f.rarity === "common"; });
  if (filterRarity === "uncommon") return FISH_SPECIES.filter(function(f) { return f.rarity === "uncommon"; });
  if (filterRarity === "rare") return RARE_FISH;
  if (filterRarity === "epic") return EPIC_FISH;
  if (filterRarity === "legendary") return FISH_SPECIES.filter(function(f) { return f.rarity === "legendary"; });
  if (filterRarity === "ultra_rare") return ULTRA_RARE_FISH;
  if (filterRarity === "crab") return BEACH_CRABS;
  if (filterRarity === "predator") return PREDATORS;
  return [];
}

function createFishCardHTML(fish) {
  var rc = RARITY_COLORS[fish.rarity] || "var(--common)";
  var rl = RARITY_LABELS[fish.rarity] || fish.rarity.toUpperCase();
  var imgHTML = fish.img
    ? '<img src="' + fish.img + '" alt="' + fish.name + '" onerror="this.parentElement.innerHTML=FISH_SILHOUETTE">'
    : '<div class="fish-placeholder">' + FISH_SILHOUETTE + '</div>';

  var stats = '';
  if (fish.points) stats += '<span class="fish-stat"><b>PTS:</b> ' + fish.points + '</span>';
  if (fish.zone) stats += '<span class="fish-stat"><b>ZONE:</b> ' + fish.zone + '</span>';
  if (fish.speed) stats += '<span class="fish-stat"><b>SPD:</b> ' + fish.speed + '</span>';
  if (fish.scareRadius) stats += '<span class="fish-stat"><b>SCARE:</b> ' + fish.scareRadius + 'px</span>';

  var starsHTML = fish.stars ? '<div class="stars" style="color:var(--gold)">' + Array(fish.stars + 1).join('*') + '</div>' : '';

  return '<div class="fish-card" data-name="' + fish.name.toLowerCase() + '" data-desc="' + (fish.description || '').toLowerCase() + '">' +
    '<div class="fish-img-wrap">' + imgHTML + '</div>' +
    '<div class="fish-info">' +
    '<div class="rarity-badge" style="background:' + rc + '">' + rl + '</div>' + starsHTML +
    '<div class="fish-name">' + fish.name + '</div>' +
    '<div class="fish-desc">' + (fish.description || '') + '</div>' +
    '<div class="fish-stats">' + stats + '</div>' +
    '</div></div>';
}

function createEquipCardHTML(item) {
  var priceHTML = item.price !== undefined ? '<div class="equip-price">' + (item.price === 0 ? 'FREE' : item.price + ' gbux') + '</div>' : '';
  var stats = '';
  if (item.catchZoneBonus !== undefined) stats += '<span class="fish-stat"><b>ZONE+:</b> ' + item.catchZoneBonus + '</span>';
  if (item.reelSpeedMult !== undefined) stats += '<span class="fish-stat"><b>REEL:</b> x' + item.reelSpeedMult + '</span>';
  if (item.lineStrength !== undefined) stats += '<span class="fish-stat"><b>LINE:</b> x' + item.lineStrength + '</span>';
  if (item.rarityBoost !== undefined) stats += '<span class="fish-stat"><b>RARE:</b> x' + item.rarityBoost + '</span>';
  if (item.type) stats += '<span class="fish-stat"><b>TYPE:</b> ' + item.type + '</span>';
  if (item.targets) stats += '<span class="fish-stat"><b>TARGETS:</b> ' + item.targets + '</span>';
  if (item.duration !== undefined) stats += '<span class="fish-stat"><b>DUR:</b> ' + item.duration + '</span>';
  var statsWrap = stats ? '<div class="equip-stats">' + stats + '</div>' : '';

  return '<div class="equip-card" data-name="' + item.name.toLowerCase() + '" data-desc="' + (item.description || '').toLowerCase() + '">' +
    '<div class="equip-icon"><img src="' + item.icon + '" alt="' + item.name + '" onerror="this.style.display=\'none\'"></div>' +
    '<div style="flex:1;">' +
    '<div class="equip-name">' + item.name + '</div>' +
    '<div class="equip-desc">' + item.description + '</div>' +
    priceHTML + statsWrap +
    '</div></div>';
}

function buildSections() {
  var container = document.getElementById("sections-container");
  var sidebar = document.getElementById("sidebar");
  var sidebarHTML = '<div class="sidebar-label">SECTIONS</div>';

  SECTIONS_CONFIG.forEach(function(cfg) {
    var variantClass = cfg.variant ? ' ' + cfg.variant : '';
    var descHTML = cfg.desc ? '<div class="section-desc">' + cfg.desc + '</div>' : '';
    var bodyHTML = '';

    if (cfg.gridType === "fish") {
      var data = getFishData(cfg.filterRarity);
      if (!cfg.count) cfg.count = data.length + ' SPECIES';
      bodyHTML = descHTML + '<div class="fish-grid">' + data.map(createFishCardHTML).join('') + '</div>';
    } else if (cfg.gridType === "equip") {
      var items = cfg.id === "rods" ? RODS : cfg.id === "lures" ? LURES : CHUM_ITEMS;
      if (!cfg.count) cfg.count = items.length + ' ITEMS';
      bodyHTML = descHTML + '<div class="equip-grid">' + items.map(createEquipCardHTML).join('') + '</div>';
    } else if (cfg.gridType === "char") {
      bodyHTML = descHTML + '<div class="char-grid">' + CHARACTERS.map(function(c) {
        return '<div class="char-card" style="border-color:' + c.color + '25"><img src="' + c.img + '" alt="' + c.name + '" onerror="this.style.display=\'none\'"><div class="char-name" style="color:' + c.color + '">' + c.name + '</div><div class="char-desc">' + c.desc + '</div></div>';
      }).join('') + '</div>';
    } else if (cfg.gridType === "zone") {
      bodyHTML = descHTML + '<div class="world-map">' + WORLD_ZONES.map(function(z) {
        var tc = z.color === "#0a1929" ? "#90a4ae" : z.color;
        return '<div class="zone-card" data-name="' + z.name.toLowerCase() + '" data-desc="' + z.desc.toLowerCase() + '" style="border-color:' + z.color + '20"><div style="position:absolute;top:0;left:0;right:0;height:3px;background:' + z.color + ';border-radius:8px 8px 0 0;"></div><div class="zone-name" style="color:' + tc + '">' + z.name + '</div><div class="zone-depth">' + z.depth + '</div><div class="zone-desc">' + z.desc + '</div><div class="zone-fish">FISH: ' + z.fish + '</div></div>';
      }).join('') + '</div>';
    } else if (cfg.gridType === "weather") {
      bodyHTML = descHTML + '<div class="weather-grid">' + WEATHER_TYPES.map(function(w) {
        return '<div class="weather-card" data-name="' + w.name.toLowerCase() + '" style="border-color:' + w.color + '25"><div style="position:absolute;top:0;left:0;right:0;height:3px;background:' + w.color + ';border-radius:8px 8px 0 0;opacity:0.6;"></div><div class="weather-name" style="color:' + w.color + '">' + w.name + '</div><div class="weather-desc">' + w.desc + '</div><div class="weather-effect">' + w.effect + '</div></div>';
      }).join('') + '</div>';
    } else if (cfg.gridType === "celestial") {
      bodyHTML = descHTML + '<div class="celestial-grid">' + CELESTIAL_EVENTS.map(function(c) {
        return '<div class="celestial-card" style="background:' + c.bgColor + ';border-color:' + c.borderColor + '"><div style="position:absolute;top:0;left:0;right:0;height:3px;background:' + c.color + ';border-radius:8px 8px 0 0;"></div><div class="celestial-name" style="color:' + c.color + '">' + c.name + '</div><div class="celestial-desc">' + c.desc + '</div><div class="celestial-boost" style="background:' + c.color + '15;color:' + c.color + ';border:1px solid ' + c.color + '30;">' + c.boost + '</div></div>';
      }).join('') + '</div>';
    } else if (cfg.gridType === "attr") {
      bodyHTML = descHTML + '<div class="attr-grid">' + ATTRIBUTES.map(function(a) {
        return '<div class="attr-card" style="border-color:' + a.color + '25"><div style="position:absolute;top:0;left:0;right:0;height:3px;background:' + a.color + ';border-radius:8px 8px 0 0;opacity:0.5;"></div><div class="attr-name" style="color:' + a.color + '">' + a.name + '</div><div class="attr-desc">' + a.desc + '</div><div class="attr-effect">' + a.effect + '</div></div>';
      }).join('') + '</div>';
    } else if (cfg.gridType === "npc") {
      bodyHTML = descHTML + '<div class="npc-grid">' + NPCS.map(function(n, idx) {
        return '<div class="npc-card" data-name="' + n.name.toLowerCase() + '"><div class="npc-img-wrap"><canvas id="npc-canvas-' + idx + '" width="48" height="48" data-src="' + n.img + '"></canvas></div><div style="flex:1;"><div class="equip-name" style="color:#4db6ac">' + n.name + '</div><div style="font-size:10px;color:#80cbc4;margin-bottom:3px;">' + n.role.toUpperCase() + '</div><div class="equip-desc">' + n.desc + '</div><div style="font-size:10px;color:var(--accent);margin-top:3px;opacity:0.7;">' + n.interact + '</div></div></div>';
      }).join('') + '</div>';
    } else if (cfg.gridType === "mechanic") {
      bodyHTML = '<div class="equip-grid">' + MECHANICS.map(function(m) {
        return '<div class="equip-card" data-name="' + m.title.toLowerCase() + '" data-desc="' + m.desc.toLowerCase() + '"><div style="flex:1;"><div class="equip-name" style="color:var(--accent)">' + m.title + '</div><div class="equip-desc">' + m.desc + '</div></div></div>';
      }).join('') + '</div>';
    } else if (cfg.gridType === "rarity") {
      bodyHTML = '<div class="equip-grid">' + RARITY_INFO.map(function(r) {
        return '<div class="equip-card"><div style="flex:1;"><div class="equip-name" style="color:' + r.color + '">' + r.title + '</div><div class="equip-desc">' + r.desc + '</div></div></div>';
      }).join('') + '</div>';
    } else if (cfg.gridType === "leaderboard") {
      bodyHTML = descHTML + '<div class="equip-grid">' + LEADERBOARD_INFO.map(function(l) {
        return '<div class="equip-card"><div style="flex:1;"><div class="equip-name" style="color:#ffd54f">' + l.title + '</div><div class="equip-desc">' + l.desc + '</div></div></div>';
      }).join('') + '</div>';
    } else if (cfg.gridType === "crab_bait") {
      bodyHTML = descHTML + '<div class="equip-grid">' + CRAB_BAITS.map(function(cb) {
        var stats = '<span class="fish-stat"><b>TIER:</b> ' + cb.tier + '</span>' +
          '<span class="fish-stat"><b>LEGENDARY:</b> ' + cb.legendaryBoost + '</span>' +
          '<span class="fish-stat"><b>RARITY:</b> x' + cb.rarityBoost + '</span>';
        return '<div class="equip-card" style="border-color:rgba(255,112,67,0.2);" data-name="' + cb.name.toLowerCase() + '" data-desc="' + cb.description.toLowerCase() + '">' +
          '<div class="equip-icon"><img src="' + cb.icon + '" alt="' + cb.name + '" onerror="this.style.display=\'none\'"></div>' +
          '<div style="flex:1;">' +
          '<div class="equip-name" style="color:#ff7043">' + cb.name + '</div>' +
          '<div class="equip-desc">' + cb.description + '</div>' +
          '<div class="equip-stats">' + stats + '</div>' +
          '</div></div>';
      }).join('') + '</div>';
    } else if (cfg.gridType === "egg") {
      var BETA_EGGS = [
        { name: "Crimson BetaXGruda Egg", icon: "/assets/eggs/egg_red.png", description: "Contains a crimson beta fish character. 1 Head of Legends. Limited: 50 worldwide." },
        { name: "Emerald BetaXGruda Egg", icon: "/assets/eggs/egg_green.png", description: "Contains an emerald beta fish character. 1 Head of Legends. Limited: 50 worldwide." },
        { name: "Sapphire BetaXGruda Egg", icon: "/assets/eggs/egg_blue.png", description: "Contains a sapphire beta fish character. 1 Head of Legends. Limited: 50 worldwide." },
        { name: "Ivory BetaXGruda Egg", icon: "/assets/eggs/egg_white.png", description: "Contains an ivory beta fish character. 1 Head of Legends. Limited: 50 worldwide." },
      ];
      var WARLORD_EGGS = [
        { name: "Warlord Egg: Dusk Tyrant", icon: "/assets/eggs/warlord_purple.png", description: "Contains the Dusk Tyrant warlord. 2 Heads of Legends. Limited: 50 worldwide." },
        { name: "Warlord Egg: Iron Sovereign", icon: "/assets/eggs/warlord_silver.png", description: "Contains the Iron Sovereign warlord. 2 Heads of Legends. Limited: 50 worldwide." },
        { name: "Warlord Egg: Venom King", icon: "/assets/eggs/warlord_green.png", description: "Contains the Venom King warlord. 2 Heads of Legends. Limited: 50 worldwide." },
      ];
      function eggCard(e, color) {
        return '<div class="equip-card" style="border-color:rgba(168,85,247,0.2);" data-name="' + e.name.toLowerCase() + '"><div style="width:40px;height:40px;border-radius:6px;overflow:hidden;background:rgba(0,0,0,0.3);flex-shrink:0;display:flex;align-items:center;justify-content:center;"><img src="' + e.icon + '" alt="" style="width:36px;height:36px;object-fit:cover;"></div><div style="flex:1;"><div class="equip-name" style="color:' + color + '">' + e.name + '</div><div class="equip-desc">' + e.description + '</div></div></div>';
      }
      bodyHTML = descHTML +
        '<div style="font-size:11px;font-weight:600;color:#ec4899;margin-bottom:8px;">BETA FISH EGGS</div>' +
        '<div class="equip-grid" style="margin-bottom:14px;">' + BETA_EGGS.map(function(e) { return eggCard(e, "#ec4899"); }).join('') + '</div>' +
        '<div style="font-size:11px;font-weight:600;color:#f59e0b;margin-bottom:8px;">WARLORD EGGS</div>' +
        '<div class="equip-grid">' + WARLORD_EGGS.map(function(e) { return eggCard(e, "#f59e0b"); }).join('') + '</div>';
    }

    var sectionHTML = '<div class="section' + variantClass + '" id="section-' + cfg.id + '" data-testid="section-' + cfg.id + '">' +
      '<div class="section-header" data-testid="header-' + cfg.id + '">' +
      '<div class="section-dot" style="background:' + cfg.dot + ';box-shadow:0 0 6px ' + cfg.dot + '"></div>' +
      '<div class="section-title" style="color:' + cfg.dot + '">' + cfg.title + '</div>' +
      '<div class="section-count">' + cfg.count + '</div>' +
      '<svg class="section-toggle" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>' +
      '</div>' +
      '<div class="section-body">' + bodyHTML + '</div>' +
      '</div>';

    container.innerHTML += sectionHTML;

    sidebarHTML += '<a class="sidebar-item" href="#section-' + cfg.id + '" data-section="section-' + cfg.id + '" data-testid="nav-' + cfg.id + '">' +
      '<div class="sidebar-dot" style="background:' + cfg.dot + '"></div>' +
      '<span>' + cfg.title + '</span>' +
      '<span class="sidebar-count">' + cfg.count + '</span></a>';
  });

  sidebar.innerHTML = sidebarHTML;
}

buildSections();

// Render first frame of NPC sprite sheets into canvas elements
document.querySelectorAll('canvas[data-src]').forEach(function(canvas) {
  var img = new Image();
  img.onload = function() {
    var ctx = canvas.getContext('2d');
    var frameH = img.height;
    ctx.drawImage(img, 0, 0, frameH, frameH, 0, 0, 48, 48);
  };
  img.src = canvas.getAttribute('data-src');
});

// Collapsible sections
document.querySelectorAll('.section-header').forEach(function(header) {
  header.addEventListener('click', function() {
    this.closest('.section').classList.toggle('collapsed');
  });
});

// Sidebar active tracking
var sidebarItems = document.querySelectorAll('.sidebar-item');
var sections = document.querySelectorAll('.section');
var observer = new IntersectionObserver(function(entries) {
  entries.forEach(function(entry) {
    if (entry.isIntersecting) {
      sidebarItems.forEach(function(item) {
        item.classList.toggle('active', item.getAttribute('data-section') === entry.target.id);
      });
    }
  });
}, { rootMargin: '-80px 0px -60% 0px', threshold: 0 });
sections.forEach(function(s) { observer.observe(s); });

// Search
var searchInput = document.getElementById('search-input');
var searchCount = document.getElementById('search-count');
searchInput.addEventListener('input', function() {
  var q = this.value.toLowerCase().trim();
  var cards = document.querySelectorAll('.fish-card, .equip-card, .zone-card, .weather-card, .npc-card');
  var visible = 0;
  var total = cards.length;

  if (!q) {
    cards.forEach(function(c) { c.classList.remove('search-hidden'); });
    searchCount.textContent = '';
    return;
  }

  cards.forEach(function(c) {
    var name = c.getAttribute('data-name') || '';
    var desc = c.getAttribute('data-desc') || '';
    var text = c.textContent.toLowerCase();
    var match = name.indexOf(q) >= 0 || desc.indexOf(q) >= 0 || text.indexOf(q) >= 0;
    c.classList.toggle('search-hidden', !match);
    if (match) visible++;
  });

  searchCount.textContent = visible + ' of ' + total + ' shown';
});

// Back to top
var backToTop = document.getElementById('back-to-top');
window.addEventListener('scroll', function() {
  backToTop.style.display = window.scrollY > 400 ? 'flex' : 'none';
});
backToTop.addEventListener('click', function() {
  window.scrollTo({ top: 0, behavior: 'smooth' });
});

// Mobile menu toggle
var mobileMenuBtn = document.getElementById('mobile-menu-btn');
var sidebar = document.getElementById('sidebar');
var sidebarOpen = false;
mobileMenuBtn.addEventListener('click', function() {
  sidebarOpen = !sidebarOpen;
  sidebar.style.display = sidebarOpen ? 'block' : 'none';
  if (sidebarOpen) {
    sidebar.style.width = '240px';
    sidebar.style.zIndex = '300';
  }
});
// Close sidebar on link click (mobile)
sidebar.addEventListener('click', function(e) {
  if (e.target.closest('.sidebar-item') && window.innerWidth < 769) {
    sidebarOpen = false;
    sidebar.style.display = 'none';
  }
});
</script>
</body>
</html>